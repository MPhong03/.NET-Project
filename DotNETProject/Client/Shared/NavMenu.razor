@using DotNETProject.Client.Service;
@using MudBlazor
@using Microsoft.AspNetCore.Components.Authorization
@inject CustomAuthStateProvider AuthStateProvider

<MudThemeProvider @bind-IsDarkMode="@_isDarkMode" Theme="_theme"/>

<MudPaper Width="250px" Class="d-inline-flex py-3" Elevation="0">
    <MudNavMenu Class="mud-width-full">
        <MudText Typo="Typo.h6" Class="px-4">ADMIN DASHBOARD</MudText>
        <MudText Typo="Typo.body2" Class="px-4 mud-text-secondary">@Admin</MudText>
        
        <MudSwitch @bind-Checked="@_isDarkMode" Color="Color.Primary" Class="ma-4" T="bool" Label="Light/Dark Mode" />


        <MudDivider Class="my-2" />
        
        <MudNavLink Href="/admin" Icon="@Icons.Material.Filled.Dashboard">Dashboard</MudNavLink>
        <MudNavLink Href="/swagger/index.html" Icon="@Icons.Material.Filled.Storage">API</MudNavLink>
        
        <MudNavGroup Title="Settings" Icon="@Icons.Material.Filled.Settings" Expanded="true">
            <MudNavLink Href="/admin/user-management" Icon="@Icons.Material.Filled.People" IconColor="Color.Success">Users</MudNavLink>
            <MudNavLink Href="/security" Icon="@Icons.Material.Filled.Security" IconColor="Color.Info" Disabled="true">Security</MudNavLink>
            <MudNavLink Href="/admin/nation-management" Icon="@Icons.Material.Filled.Flag" IconColor="Color.Error">Nation</MudNavLink>
        </MudNavGroup>

        <MudNavGroup Title="Casting" Icon="@Icons.Material.Filled.Settings" Expanded="true">
            <MudNavLink Href="/admin/cast-management" Icon="@Icons.Material.Filled.People" IconColor="Color.Success">Actors - Actresses</MudNavLink>
            <MudNavLink Href="/admin/director-management" Icon="@Icons.Material.Filled.PersonOutline" IconColor="Color.Info">Director</MudNavLink>
        </MudNavGroup>

        <MudNavGroup Title="Film" Icon="@Icons.Material.Filled.Settings" Expanded="true">
            <MudNavLink Href="/admin/movie-management" Icon="@Icons.Material.Filled.Movie" IconColor="Color.Success">Movie</MudNavLink>
            <MudNavLink Href="/admin/TVSeries-management" Icon="@Icons.Material.Filled.Tv" IconColor="Color.Success">TVSeries</MudNavLink>
            <MudNavLink Href="/admin/genre-management" Icon="@Icons.Material.Filled.Tag" IconColor="Color.Success">Genre</MudNavLink>
        </MudNavGroup>

    </MudNavMenu>
</MudPaper>

@code {
    private string Admin;
    private MudTheme _theme = new();
    private bool _isDarkMode;
    private string title;
    private bool dataChanged = false;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        Admin = authState.User.Identity.Name;
        title = (_isDarkMode) ? "Dark" : "Light";
    }

    // protected override async Task OnAfterRenderAsync(bool firstRender)
    // {
    //     if (!firstRender && dataChanged)
    //     {
    //         dataChanged = false;
    //         await RefreshData();
    //     }
    // }

    // private async Task RefreshData()
    // {
    //     title = (_isDarkMode) ? "Dark" : "Light";
    //     StateHasChanged();
    // }
}